\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
%Template version as of 6/27/2024

\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}

\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

\begin{document}

\title{Accelerometer and Gyroscope based IoT System for Activity Classification and Monitoring\\
}

\author{\IEEEauthorblockN{Séamus Knightly}
\IEEEauthorblockA{\textit{1MECE1} \\
\textit{University Of Galway}\\
Galway, Ireland\\
s.knightly1@universityofgalway.ie}
\and
\IEEEauthorblockN{Seán Kelly}
\IEEEauthorblockA{\textit{1MECE1} \\
\textit{University Of Galway}\\
Galway, Ireland \\
s.kelly178@universityofgalway.ie}
}

\maketitle

\begin{abstract}
This document is a model and instructions for \LaTeX.
YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS YOLKS 
\end{abstract}

\begin{IEEEkeywords}
IoT, Remote Patient Monitoring, Accelerometer, Gyroscope, Classification, Assisted Living
\end{IEEEkeywords}

\section{Introduction}


\subsection{Problem Statement}

\subsubsection{Current Situation}
Real-time monitoring of human activity has valuable applications in healthcare, helping to improve patient care, reduce the workload on healthcare staff, and lower costs while enhancing quality of life \cite{b1}. The INMO has stated that the nursing shortage which began in 2007 continues to worsen into 2025\cite{inmo}. This shortage continues to affect rehabilitation facilities, senior living facilities, and other areas where patient movement is key to recovery and continued health.

\subsubsection{Need for IoT System}
Despite this potential, many current monitoring solutions remain limited. Systems such as pendant alarms, deployed through initiatives like the Seniors Alert Scheme, require manual activation by the user in the event of a fall \cite{b2}. This dependency on user input makes them less reliable in emergency situations. Automatic fall detection systems still face challenges with false alarms and missed detections. One study reported that an accelerometer based prototype detected only 80\% of real world falls, with false alarms occurring approximately once every 40 hours of use \cite{b3}. These technological limitations are compounded by staff shortages in the health and social care sector, which place additional strain on staff morale and reduce care quality \cite{b4}. These factors show that there is a need for reliable IoT based solutions that can provide continuous, accurate, and scalable monitoring, which can serve as the foundation for a real-time fall detection monitoring system. This project aims to build a reliable system which fulfils a real-world need, and provides a foundation for future work in this area.

\subsubsection{Aim and Objectives}\label{AO}
The aim of this project is to design and implement an IoT system for activity classification and monitoring using inertial sensors and machine learning. The objectives are to:
\begin{itemize}
	\item Acquire accelerometer and gyroscope data from an IoT device
	\item Transmit sensor data in real time to an IoT gateway
	\item Perform preprocessing at the gateway, including filtering, windowing, and feature extraction
	\item Push the data to a Cloud-based Machine Learning and Data Analytics platform for classification and storage
	\item Implement monitoring of the time-series data with configurable alarms based on healthcare needs
\end{itemize}

\section{System Design}

\subsection{Design Requirements}
There are several key requirements which must be considered when designing wearable IoT devices:
\begin{itemize}
	\item Long operational period / battery life
	\item Medium-range communication - 10-30 meters including walls
	\item Reliable data transmission
	\item Accurate sensing - for activity classification, accurate motion sensing
	\item Comfort - wearables need to be small and lightweight
\end{itemize}

The device must be able to run for at least 24 hours, ideally much longer, between charges to avoid frequent patient disturbance and unnecessary additional work for healthcare workers. The device ideally needs to be able to communicate at medium-range including at least one wall in a hospital or senior living environment if it is to be an effective activity tracker. With the goal of the project being real-time classification and alerting, the data stream needs to be consistent and reliable, not reconnecting frequently or dropping packets. Additionally, the sensors employed for motion sensing, mainly accelerometers and gyroscopes, must be precise enough to allow the classifier to distinguish between different activities, however this is less of a concern as smartphones have had this technology for over a decade. The component selections outlined in Section~\ref{components} aim to fulfil or exceed all of these requirements where possible, whilst also outlining a suitable prototyping platform for the device.

\subsection{Block diagram of the IoT system}
The overall architecture of the IoT system is illustrated in Fig.~\ref{fig:block_diagram}. The future expansion of the project is represented by the blocks with dotted outlines.

\begin{figure}[h]
	\centering
	\includegraphics[width=0.5\textwidth]{media/basic_diagram.png}
	\caption{Block diagram of the IoT system, showing the layered design from sensing to future cloud integration.}
	\label{fig:block_diagram}
\end{figure}


\subsection{Simplified IoT architecture}

The system follows a simplified three-layer IoT architecture. The Sensing and Perception Layer is composed of a wearable sensor node, a compact hip-worn device with a 6-axis IMU for motion capture, where 3 axes are provided by the accelerometer and 3 axes are provided by the gyroscope, giving access to detailed movement information. The device also features a microcontroller with an accompanying BLE module, a battery management system module, and a rechargeable battery.

The Gateway / Edge Compute Layer features an IoT Gateway with a BLE module for collecting data from multiple sensor nodes, internet connectivity (by WiFi or Ethernet), and a powerful system-on-chip capable of data filtering, windowing, and feature extraction in real-time for multiple wearable devices. It is intended to be a stationary gateway mounted in a central location where it can capture data from many devices, process it, and push it to a cloud data processing pipeline.

The Application Layer consists of a machine-learning and data analytics pipeline where a machine learning model classifies the current activity using the received data. The classification, time, and received data are saved in a time-series database for long-term storage, allowing healthcare professionals to access historical activity data for their patients, and configure alerting for patients who are idle for too long or who may be over-active during their recovery.

\section{Component Selections}\label{components}

\subsection{Sensing module}
The BMI160 Low-Power 6-Axis IMU\cite{BMI160} combines a 3-axis accelerometer and a 3-axis gyroscope, both supporting $\pm2G$, $\pm4G$, $\pm8G$, and $\pm16G$ modes, configurable over its serial interface. It uses a simple I2C interface and can operate at voltages between 1.7 and 3.6v, consuming only 1mA when both the accelerometer and gyroscope are active at a 100Hz sample rate. It can be configured to operate at lower sample rates and uses just $180\mu A$ when in accelerometer-only mode at 100Hz. It also features intelligent power management and can go into a sleep state during rest, reactivating the gyroscope only when movement is detected, further reducing power consumption. Bosch advertises this device as an ideal choice for wearable IoT devices.

Altogether this sensor meets the ultra-low power requirement, has more than sufficient resolution at 16-bit, provides all essential data for the machine learning pipeline, and is a widely used option in the field.

The BMI270, also from Bosch SensorTec, is the next-generation model of the BMI160, providing more accuracy, self-calibration, and movement recognition, and while some of these features may be useful in this context, it does not justify the increased cost, significant increase in firmware complexity due to its boot-time configuration requirement, and higher power draw.

Similarly, the MPU-6050, a highly well-known IMU in industry, also elicits a 4x higher power consumption than the BMI160 in a larger package - at 3.9 mA, it is still a viable choice, however with the wide availability of the BMI160, it remains the ideal choice.

\subsection{IoT Node}
The Nordic nRF52810 microcontroller\cite{nRF52810} is an ideal choice for powering the wearable IoT node. It features a 32-bit ARM Cortex-M4 processor running a 64 Mhz, and 192kB flash memory with 24kB of RAM. This is more than sufficient for simple data collection, packaging, and transmission. It also features integrated BLE 5.0 meaning an external module is not needed. It consumes a miniscule $2.0\mu A$ at 3.3 volts when idle, and peaks at just 4.6mA when transmitting or receiving data, making it an ideal choice for a low-power wearable IoT device. The chip also supports ANT, and has a 2.4Ghz transceiver which can be used to develop proprietary protocols if needed.

Another option which was considered is the STM32L031 - an excellent low power option which costs slightly less than the nRF52810, however, this microcontroller does not feature an on-board BLE module, thus ultimately raising the price and design complexity by requiring an external communication IC. 

Other platforms like the Espressif ESP32-C3 are used widely in IoT projects, offering Wi-Fi as well as BLE connectivity, more processing power, and cryptography acceleration\cite{b8}, they typically have a much higher power requirement, as much as 130mA while active. Using these in production comes with an increased cost for no benefit and vastly diminishes battery life.

The Adafruit FeatherSense nRF52840\cite{b7} was chosen as a prototyping board for the project. This board provides a microcontroller from the same family as the production microcontroller, and integrates multiple sensors (e.g., accelerometer/gyroscope, magnetometer, microphone, temperature, humidity, and pressure sensors) along with native BLE support. For this project, only the accelerometer and gyroscope were used, as these sensors correspond with the data requirements of the HARTH dataset \cite{b5,b6} powering the activity classifier in the Cloud IoT pipeline.

\subsection{Gateway}
The Raspberry Pi 4 served as the IoT gateway. This device was issued for this project, and it has the sufficient computing capacity, integrated BLE support, and compatibility with Python's data acquisition and processing libraries. 
\textbf{[@Sean: again, if you want to add anything here. I think from the brief maybe we do need to do some comparison, like what I did inthe last paragraph]} 

\subsection{Communication}
BLE was the protocol used, as it is the only wireless option natively supported by the FeatherSense nRF52840 board. An initial implementation used BLE UART with CBOR encoding. However this was too slow. To meet the 50~Hz sampling target, the system was reimplemented using BLE GATT, transmitting fixed length packets of six floating point values. This achieved stable operation at the required frequency.

\subsection{Power}
For prototyping, the FeatherSense was powered via USB, which ensured stability and ease of development. The board supports battery operation, but this was not implemented for Deliverable I, which focused on demonstrating data acquisition and transmission. In a full deployment scenario, low-power optimisation and battery usage would become essential for continuous wearable operation.

\textbf{[@Sean: IDk I can look at the code and see if there is anything we can do to help with power consumption, just to say yeah in future we can do this. Not sure fully what to say on this point.]} 



\section{Prototype Design Plan}

\subsection{Subsystems}
The prototype will be structured into four main subsystems: 
\begin{itemize}
	\item \textbf{Sensing:} inertial data acquisition from the FeatherSense accelerometer and gyroscope. 
	\item \textbf{Communication:} wireless transmission via BLE, using GATT as the chosen protocol. 
	\item \textbf{Edge Processing:} real-time data handling and basic feature extraction on the Raspberry Pi 4. 
	\item \textbf{Visualisation:} plotting of data streams to confirm correct reception and interpretation. 
\end{itemize}
This breakdown will ensure that each component of the system can be developed and validated independently before integration. 

\subsection{Integration Plan}
The system will be developed incrementally. The sensor subsystem will first be validated by confirming raw inertial readings on the FeatherSense. Next, BLE transmission will be tested in isolation before final integration. Finally, the gateway will be configured to receive and interpret packets, after which end to end data flow from sensing to visualisation will be verified. 


\textbf{[@Sean: idk really, if you have any thoughts on the above two sections.]}

\subsection{Verification Plan}
Verification activities will be designed to ensure that the prototype meets Deliverable~I requirements. The main checks will include:
\begin{itemize}
	\item Confirming that BLE transmission achieves the target 50~Hz sampling rate. 
	\item Ensuring data packets are correctly structured and fully decoded at the gateway. 
	\item Validating that received sensor values fall within expected physical ranges (e.g., acceleration values near $\pm 9.8~\text{m/s}^2$ for gravity). 
	\item Measuring packet loss rates to assess communication reliability. 
\end{itemize}


\subsection{Verification Plan}
Verification activities will be designed to ensure that the prototype meets Deliverable~I requirements. The main checks will include:
\begin{itemize}
	\item Confirming that BLE transmission achieved the target 50~Hz sampling rate. 
	\item Ensuring data packets were correctly structured and fully decoded at the gateway. 
	\item Validating that received sensor values were within expected physical ranges (e.g., acceleration values near $\pm 9.8~\text{m/s}^2$ for gravity). 
\end{itemize}

\textbf{[@Sean: again, some more stuff here maybe on what we are doing with regards verification. Will need to test packet loss. This verification section is just chatgpt nonsense atm]}

\section{Implementation}
\subsection{Feathersense Node Setup}
The sensor node was implemented using the Adafruit FeatherSense nRF52840 board. The LSM6DS3 IMU was configured to sample at 50Hz, in line with the publicly available HARTH dataset. Sensor readings (acceleration in m/s\textsuperscript{2} and angular velocity in deg/s) were acquired in real time through the Adafruit CircuitPython libraries. 

\subsection{Communication Performance}
An initial implementation used the Nordic UART Service over BLE, with payloads encoded in CBOR format. This implementation was functional, but very inneficient. The structured CBOR packets were relatively large, so the transmission was slower and there was an increased coding and decoding overhead on both device and gateway. As a result, the effective sampling rate was limited to approximately 11~Hz, and partial reads often caused incomplete or dropped data. The performance was too poor to be considered as an option, and further measurements of latency or packet loss were not taken in this configuration. 

To address the issues found with the UART method, the system was reimplemented using a custom GATT service with two vendor-defined UUIDs (one for the service and one for the sensor characteristic). Instead of transmitting dictionary structures, the new approach packed six 32 bit floating point values (ax, ay, az, gx, gy, gz) into a fixed length 24 byte payload. This enabled stable streaming at the target rate of 50~Hz without the packet corruption or decoding delays observed previously.

\textbf{[TODO: Record and report packet loss statistics in current implementation.]} 




\section{Implementation of Gateway Device}
\textbf{[@Sean: I'll leave this to you]} 
\subsection{Data collection on Raspberry Pi}
connection with Feathersense via BLE GATT.

\subsection{Streaming Visualisation}
 live plotting of received sensor data.

(Screenshots/graphs of plots go here.)

\section{Edge/Fog Processing}
Jerk calculation (derivative of acceleration).

Magnitude of accel/gyro.

Other features relevant for ML (you can mention RMS, variance, etc. if planned).

Show small plots of raw vs processed features.


\subsection{Discussion \& Conclusion}
\textbf{[@Sean: this once we've done the rest of course]} 
Summary: successful acquisition, transmission, preprocessing.

Limitations: still simulated/early prototype, real-world testing needed.

Next steps (for Deliverable II): deploy ML in cloud, integrate with Power BI.

\bibliographystyle{IEEEtran}
\bibliography{references}


\end{document}